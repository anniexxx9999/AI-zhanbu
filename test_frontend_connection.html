<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯è¿æ¥æµ‹è¯•</title>
</head>
<body>
    <h1>å‰ç«¯åˆ°åç«¯è¿æ¥æµ‹è¯•</h1>
    <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
    <div id="result"></div>

    <script>
        async function testConnection() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æµ‹è¯•è¿æ¥...</p>';
            
            try {
                // æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥
                const healthResponse = await fetch('http://localhost:3001/api/health');
                const healthData = await healthResponse.json();
                
                if (healthData.status === 'healthy') {
                    resultDiv.innerHTML += '<p style="color: green;">âœ… åç«¯å¥åº·æ£€æŸ¥é€šè¿‡</p>';
                } else {
                    resultDiv.innerHTML += '<p style="color: red;">âŒ åç«¯å¥åº·æ£€æŸ¥å¤±è´¥</p>';
                    return;
                }
                
                // æµ‹è¯•å æ˜ŸAPI
                const astrologyResponse = await fetch('http://localhost:3001/api/astrology/chart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: "è¿æ¥æµ‹è¯•",
                        date: "1990-01-01",
                        time: "12:00",
                        city: "åŒ—äº¬",
                        latitude: 39.9042,
                        longitude: 116.4074,
                        timezone: "Asia/Shanghai"
                    })
                });
                
                if (!astrologyResponse.ok) {
                    throw new Error(`HTTP error! status: ${astrologyResponse.status}`);
                }
                
                const astrologyData = await astrologyResponse.json();
                
                if (astrologyData.success) {
                    resultDiv.innerHTML += `
                        <p style="color: green;">âœ… å æ˜ŸAPIè°ƒç”¨æˆåŠŸ</p>
                        <p><strong>å§“å:</strong> ${astrologyData.data.birthInfo.name}</p>
                        <p><strong>æ•°æ®æº:</strong> ${astrologyData.data.source || 'å…è´¹API'}</p>
                        <p><strong>è¡Œæ˜Ÿæ•°é‡:</strong> ${astrologyData.data.planets.length}</p>
                        <p><strong>å®«ä½æ•°é‡:</strong> ${astrologyData.data.houses.length}</p>
                        <p style="color: green;">ğŸ‰ å‰åç«¯è¿æ¥å®Œå…¨æ­£å¸¸ï¼</p>
                    `;
                } else {
                    resultDiv.innerHTML += '<p style="color: red;">âŒ å æ˜ŸAPIè°ƒç”¨å¤±è´¥</p>';
                }
                
            } catch (error) {
                resultDiv.innerHTML += `<p style="color: red;">âŒ è¿æ¥å¤±è´¥: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
